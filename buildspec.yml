version:
    0.2

    #env:
    #variables:
    # key: "value"
    # key: "value"
    #parameter-store:
    # key: "value"
    # key: "value"
    #secrets-manager:
    # key: secret-id:json-key:version-stage:version-id
    # key: secret-id:json-key:version-stage:version-id
    #exported-variables:
    # - variable
    # - variable
    #git-credential-helper: yes
    #batch:
    #fast-fail: true
    #build-list:
    #build-matrix:
#build-graph:
phases:
    #install:
    #If you use the Ubuntu standard image 2.0 or later, you must specify runtime-versions.
    #If you specify runtime-versions and use an image other than Ubuntu standard image 2.0, the build fails.
    #runtime-versions:
    # name: version
    # name: version
    #commands:
    #- npm install -g @microsoft/rush
    # - command
    pre_build:
        commands:
            - docker login -u $DOCKER_USER -p $DOCKER_PASS
            - aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin $DOCKER_REPOSITORY
    build:
        commands:
            - docker build -t backend:$DOCKER_TAG --build-arg SHOPIFY_API_KEY=90f89903b29be602b55d4ecf1e62bdbe -f ./Dockerfile .
            # - command
    post_build:
        commands:
            - docker tag backend:$DOCKER_TAG $DOCKER_REPOSITORY:$DOCKER_TAG
            - docker push $DOCKER_REPOSITORY:$DOCKER_TAG
            - for taskarn in $(aws ecs list-tasks --cluster $CLUSTER --service $SERVICE --desired-status RUNNING --output text --query 'taskArns'); do aws ecs stop-task --cluster $CLUSTER --task $taskarn; done;
            # - command
            # - command
            #reports:
            #report-name-or-arn:
            #files:
            # - location
            # - location
        #base-directory: location
        #discard-paths: yes
        #file-format: JunitXml | CucumberJson
        #artifacts:
        #files:
        # - location
        # - location
        #name: $(date +%Y-%m-%d)
        #discard-paths: yes
        #base-directory: location
        #cache:
        #paths:
        # - paths
